

<div class="card">
    <div class="card-header"><h5>Out Stock</h5></div>
    <div class="card-body">
        <table id="tbloutstock" class="table table-striped w-100">
            <thead>
                <tr>
                    <th>Spare ID</th>
                    <th>Part Code</th>
                    <th>Part Name</th>
                    <th>Maker</th>
                    <th>CurrentQty</th>
                    <th>
                        Location
                    </th>
                    <th> Remark </th>
                    <th>Action</th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script>
    $(function () {

        const tbl = $('#tbloutstock').DataTable({
            ajax: '/SparePart/GetOutStock',
            columns: [
                { data: 'SpareID' },
                { data: 'Code' },
                { data: 'Name' },
                { data: 'Maker' },
                { data: 'CurrentQty' },
                { data: 'Location' },
                { data:'Remark'},
                {
                    data: null,
                    render: d => `<button class="btn btn-sm btn-primary btndathang" data-id="${d.SpareID}">Đặt hàng</button>`
                }
            ]
        });

        $('#tbloutstock').on('click', '.btndathang', async function () {
            const id = $(this).data('id');
            const $btn = $(this);

            let qty = prompt(`Nhập số lượng đặt`);

            if (qty === null) return; // Cancel
            qty = parseInt(qty);
            let data = [];

            data.push({
                SpareID: id,
                Qty: qty
            });

            $.ajax({
                url: '/SparePart/CreateRequest',
                type: 'POST',
                data: {
                    Remark: "Đặt hàng out stock",
                    Details: JSON.stringify(data)
                },
                success: function (res) {
               
                    if (res.success) {
                 
                        tbl.ajax.reload();
                        showNotification('Đã hàng thành công!', 'success');
                    } else {
                        showNotification('Lỗi: ' + res.message, 'error');
                        $btn.prop('disabled', false).text('Approve');
                    }
                },
                error: function (xhr, status, error) {
                    showNotification('Không thể kết nối server: ' + error, 'error');
                    $btn.prop('disabled', false).text('Approve');
                }
            });
        });
        function showNotification(message, type) {
            // Sử dụng toastr nếu có, hoặc dùng alert
            if (typeof toastr !== 'undefined') {
                if (type === 'success') {
                    toastr.success(message);
                } else {
                    toastr.error(message);
                }
            } else {
                alert(message);
            }
        }
    });

</script>
